---
title:      "An Initial investigation into WDDM on ReactOS"
author:     "The_DarkFire_"
date:       2025-10-3
tags:       [ newsletter, wddm ]
---

ReactOS’s history spans a wider range than the lives of many of the people who work on it today. Incredible individuals have come and gone from the project with vastly different goals for what they want to see developed. In recent years It’s become more of an interest to work on hardware support. As ReactOS brings its gaze onto the world of Vista a few topics regarding how hardware works make themselves known. Vista introduced massive overhauls to how hardware drivers are written and maintained; Gradually we’re trying to handle many of these overhauls with some great success. The blog post today is about WDDM, or the Windows Display Driver Model.

### The “Overhaul”
I’ve always found the video driver documentation lacking for both architectures, enough to get started but not really enough to get deep into the world of 3D. Thankfully in recent years this has changed enough to where some open source, individual written drivers have popped up. In essence WDDM is an overhaul that splits responsibility of the GPU away from win32k and provides a far more fluid, and evolving control over the GPU to the driver vendor. Dxgkrnl.sys talks to a miniport driver to have different levels of the interface filled in. The WDDM revision (WDDM 1.0, 1.1, 1.2….) only really describes how much of these interfaces are supported and implemented. This is different than the feature level that is described in DxDiag. 
(note: maybe a picture of win10 dxdiag here).

### Wait… What happened to XDDM?
	Officially starting with Windows 8 every GPU driver for the system had to be a WDDM driver. But all that was really dropped was the miniport portion. Vista/7 could always still load XP gpu drivers without a complaint. 
(note: picture of 8800GTS on Vista with XP?)
Outside of the miniport portion, Windows still has XDDM remnants all over the mechanisms that make WDDM work. The first real example of this came when trying to load Vista OpenGL ICD, or loading ours on Vista or 7.. 8.. So on. For WDDM the communication back to the miniport driver is more direct, win32k only holds the syscall jump back into an interface that’s filled in by dxgkrnl, it’s important to note the module that loads OpenGL ICD hasn’t changed very much. 
(note: Vista OpenGL on ReactOS)
Interestingly Vulkan behaves similarly 
(note Vulkan on ReactOS)
	OpenGL ICDs are one thing but what about the display driver? Watching what Vista and later win32k does while starting up shows some interesting behaviors. There’s two important display drivers we should talk about: TSDDD.dll and CDD.dll, TSDDD is manually loaded when session 0 starts. This is just a normal XDDM display driver that does nothing except write to some blank memory. In NT5.x, or ReactOS at the time of writing if your install can’t get a valid display it’ll bug check with a code meaning video initialization failure. It’s possible to still make this happen with Vista and later but this win32k failure no longer happens in convention due to this change. 
 CDD.dll is far more interesting on one hand it is an XDDM display driver as well. It also fires off two different IOCTLs which do the communication to WDDM. Indeed this driver is by all accounts the only route at which Dxgkrnl <-> win32k talk to each other in any meaningful capacity. Technically there’s an a bit of communication between watchdog, win32k and dxgkrnl to facilitate initialization and to fill in the interface to dispatch d3dkmt APIs down to DxgKrnl but that’s only during the start up of DxgKrnl itself. It’s also worth noting, when this happens the query in win32k to find a supported display adapter is always manually overwritten with cdd.dll. Once you start a WDDM driver you cannot run a XDDM at the same time! 
	Alright well that was a lot of information but there’s some important things to understand here. CDD.dll first and foremost IS an XDDM display driver, even if it’s translating from the old world win32k to the new world WDDM stack it’s still stressing win32k out. This means for ReactOS simply to be truly compatible with WDDM and get vendor drivers to start up their display properly we need to make sure our XDDM stack is in great shape. This isn’t the only Vista+ feature that has this requirement, DWM itself (which is worth its own blog post) does a lot of things that even the current ReactOS win32k just isn’t capable of handling quite yet. But we're constantly improving.
 (note reactos cdd on vista)
### Compiling WDDM drivers with ReactOS
One of the first components that needed to be understood was displib.lib a component shipped with the WDK that allows for compiling WDDM drivers. https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/dispmprt/nf-dispmprt-dxgkinitializedisplayonlydriver
In order for you to compile a WDDM driver you need to link with a library that implements a function like the above to actually allow your driver to “start” DxgKrnl, as WDDM drivers don’t link against Dxgkrnl at all! Instead when you call an API like the above or it’s full WDDM twin you pass the information to DxgKrnl it needs to callback to your miniport’s initialization routine and this is what gives you the necessary interfaces to talk to DxgKrnl further. Win32k has nothing to do with your miniport driver starting up! This was relatively straightforward to make an alternative to, opening the door for ReactOS to import and compile WDDM drivers that even work on windows!
(note reactos compiled bochs wddm driver on vista)
### WDDM! Technically..?
	Now that we know how WDDM drivers start up we can start to find where one could in theory start building this architecture on top of ReactOS. The D3DKMT APIs are only used for DirectX and OpenGL acceleration so we can ignore that for now. What about just getting the display to work? ReactOS currently supports some 2D acceleration and is rapidly developing support for XDDM AMD GPUs so surely we can get some kind of basis working? DxgKrnl is a massive beast with a scheduler and many subsystems for managing these miniport drivers but only two are really required for display management VidPn (Video Presentation Network) and its hardware support. Starting with Windows 8 there’s a built in driver and style of WDDM miniports that drop 3D acceleration called KMDOD’s. They’re a slightly different initialization type but in general are easy to understand. Thankfully they don’t use a lot of the interfaces DxgKrnl provides to miniport drivers to communicate with the hardware so we can create a very simple DxgKrnl for our thought experiment. All we need is to query the display modes from the VidPn network, pass it to cdd, load cdd when dxgkrnl is active and.. Ah hah!
(note reactos running Microsoft Basic Display Adapter)
ReactOS can communicate with its first WDDM driver!

### A more forgiving architecture
When I first got BasicDisplay.sys loading in ReactOS I noticed how forgiving WDDM truly was. I realized I could escalate this further than I’d anticipated. It turned out these vendor drivers are very willing to accept being started just for their display for example.
[note reactos running a 1070 series card in 2D mode] 
I was quickly getting more drivers to show some kind of display out, allowing ReactOS to power modern monitors at their follow resolutions. But I quickly was getting limited not by the implementation of our win32k but instead our support for hardware itself.

### The future - Why i made this
There’s two things I hoped to accomplish with this blog post. The first was to put out that ReactOS is indeed looking at trying to support later hardware, but that we can’t just jump and ignore XDDM. XDDM is REQUIRED for WDDM, we need to continue to improve in this area. The other reason was because this is the first of a few blog posts I intend to write for the ReactOS project on this subject. We’ve been actively working to improve hardware support to unblock these future ideas and need more support to do so! Look forward to more hardware support blog posts, and soon, maybe far more interesting ones about WDDM.